<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>G√©n√©rateur de cartes NAO/TT ‚Äî JSON ‚Üí Cartes</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div>
      <h1>G√©n√©rateur de cartes NAO/TT</h1>
      <p class="sub">Edite le JSON ci-dessous pour ajouter tes cartes. Place les images dans <code>assets/cards/</code> et rafraichis la page.</p>
    </div>
    <div class="pill"><span class="dot" style="background:#ff3b3b"></span><strong>CGT</strong> ‚Ä¢ NAO 2026</div>
  </header>

  <section class="toolbar" aria-hidden="false">
    <div class="left">
      <span class="pill"><span style="font-weight:900">Filtres</span></span>

      <select id="filterType" aria-label="Filtre type">
        <option value="ALL">Tout</option>
        <option value="NAO">NAO</option>
        <option value="TT">TT</option>
      </select>

      <select id="filterRarity" aria-label="Filtre raret√©">
        <option value="ALL">Toutes raret√©s</option>
        <option value="LEGENDARY">L√©gendaire</option>
        <option value="ULTRA_RARE">Ultra rare</option>
        <option value="RARE">Rare</option>
        <option value="COMMON">Commune</option>
      </select>

      <input id="search" type="search" placeholder="Recherche (ex: transport, 13e, vendredi‚Ä¶)" />
    </div>

    <div class="right">
      <button id="btnCopyJson">Copier JSON</button>
      <button onclick="window.print()">Imprimer</button>
    </div>
  </section>

  <main id="cards" class="grid" aria-live="polite"></main>

  <script>
    /* =====================
       EDITE ICI LE JSON
       Met les images dans assets/cards/ (ex: assets/cards/13e-mois.png)
       ===================== */
    const CARDS_JSON = [
      {
        id: "NAO-01",
        type: "NAO",
        title: "13·µâ mois p√©renne",
        subtitle: "Pouvoir d'achat durable",
        rarity: "LEGENDARY",
        icon: "CHEST",
        image: "assets/cards/13e-mois.png",
        stats: { "Pouvoir d'achat": 5, "Stabilit√©": 5, "Justice sociale": 5, "Impact collectif": 5 },
        desc: "Int√©gration d'un 13·µâ mois dans le brut annuel.\nUn revenu stabilis√©, s√©curis√© et p√©renne pour toutes et tous.",
        footerLeft: "NAO 2026 ‚Ä¢ CGT",
        footerRight: "√âdition revendications"
      },
      {
        id: "NAO-02",
        type: "NAO",
        title: "Augmentation +5,75 %",
        subtitle: "Rattrapage & √©quit√©",
        rarity: "ULTRA_RARE",
        icon: "ARROW",
        image: "assets/cards/augmentation.png",
        stats: { "Pouvoir d'achat": 5, "√âquit√©": 5, "Urgence": 4, "Solidarit√©": 5 },
        desc: "Augmentation g√©n√©rale de 5,75 % pour l'ensemble des salari√©¬∑es.\nRattrapage automatique pour celles et ceux non augment√©¬∑es depuis 3 ans.",
        effect: "‚ú® Active un bonus collectif imm√©diat : fin des r√®gles arbitraires et du favoritisme.",
        footerLeft: "NAO 2026 ‚Ä¢ CGT",
        footerRight: "Pouvoir collectif"
      },
      {
        id: "TT-03",
        type: "TT",
        title: "T√©l√©travail non r√©vocable",
        subtitle: "Stabilit√© & respect des vies perso",
        rarity: "RARE",
        icon: "HOME_SHIELD",
        image: "assets/cards/remote.png",
        stats: { "√âquilibre vie pro/perso": 5, "Protection": 5, "Stabilit√©": 4, "Justice territoriale": 5 },
        desc: "Accord collectif stable et non r√©vocable.\nLe t√©l√©travail ne peut pas √™tre suspendu de mani√®re unilat√©rale : c'est une condition de travail.",
        effect: "üõ° Prot√®ge contre les d√©cisions arbitraires et les pressions disciplinaires.",
        footerLeft: "T√©l√©travail 2026 ‚Ä¢ Droits collectifs",
      }
    ];

    /* =====================
       Helper functions
       ===================== */
    function safe(s){ return String(s ?? ""); }
    function stars(n){ n = Math.max(0, Math.min(5, Number(n)||0)); return "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ".slice(5-n, 10-n); }
    function rarityToTheme(r){
      switch(r){
        case "LEGENDARY": return { cls: "theme-gold", label: "L√âGENDAIRE" };
        case "ULTRA_RARE": return { cls: "theme-purple", label: "ULTRA RARE" };
        case "RARE": return { cls: "theme-blue", label: "RARE" };
        default: return { cls: "theme-red", label: "COMMUNE" };
      }
    }

    /* Inline simple SVG fallback icons */
    function iconSVG(kind){
      if(kind === "ARROW"){
        return `<svg viewBox="0 0 200 200" width="140" height="140" aria-hidden="true">
          <rect x="20" y="30" width="160" height="140" rx="18" fill="rgba(255,255,255,0.04)"/>
          <path d="M35 135 L80 110 L110 120 L150 80" fill="none" stroke="#ff7cff" stroke-width="12" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>`;
      } else if(kind === "HOME_SHIELD"){
        return `<svg viewBox="0 0 200 200" width="140" height="140" aria-hidden="true">
          <circle cx="78" cy="92" r="60" fill="rgba(255,255,255,0.06)"/>
          <path d="M40 92 L80 58 L120 92" fill="none" stroke="#ff6b6b" stroke-width="10" stroke-linecap="round" stroke-linejoin="round"/>
          <rect x="52" y="92" width="56" height="54" rx="10" fill="rgba(255,255,255,0.12)"/>
        </svg>`;
      } else {
        return `<svg viewBox="0 0 200 200" width="140" height="140" aria-hidden="true">
          <circle cx="100" cy="95" r="70" fill="rgba(255,235,140,0.18)"/>
          <rect x="45" y="95" width="110" height="65" rx="10" fill="#8b3a10" />
        </svg>`;
      }
    }

    /* Render function */
    function render(cards){
      const mount = document.getElementById("cards");
      mount.innerHTML = "";

      cards.forEach(card => {
        const t = rarityToTheme(card.rarity);
        const statsRows = Object.entries(card.stats || {}).map(([k,v]) => `
          <div class="stat-name">${safe(k)}</div>
          <div class="stars">${stars(v)}</div>
        `).join("");

        const effect = card.effect ? `<p class="effect"><span>‚ú®</span><span>${safe(card.effect)}</span></p>` : "";

        const artContent = card.image
          ? `<img class="card-art" src="${safe(card.image)}" alt="${safe(card.title)}">`
          : iconSVG(card.icon);

        const el = document.createElement("section");
        el.className = `card ${t.cls}`;
        el.innerHTML = `
  <div class="frame"></div>
  <div class="content">
    <div class="header">
      <div class="topbar">
        <div class="badge">${t.label}</div>
        <div class="code">${safe(card.id)}</div>
      </div>

      <h2 class="title">${safe(card.title)}</h2>
      <div class="subtitle">${safe(card.subtitle)}</div>
    </div>

    <div class="art" data-image="${safe(card.image || '')}">
      ${artContent}
      <div class="art-overlay" aria-hidden="true"></div>
      <div class="mini-glow"></div>
    </div>

    <div class="stats">${statsRows}</div>

    <p class="desc">${safe(card.desc)}</p>

    ${effect}

    <div class="footer">
      <span><strong>${safe(card.footerLeft || (card.type === "TT" ? "T√©l√©travail 2026" : "NAO 2026"))}</strong></span>
      <span class="tiny">${safe(card.footerRight || "CGT")}</span>
    </div>
  </div>
`;
        mount.appendChild(el);
      });
    }

    /* Filtering */
    function cardMatchesFilters(card, {type, rarity, q}){
      const hay = [
        card.id, card.type, card.title, card.subtitle,
        card.rarity, card.desc, card.effect || ""
      ].join(" ").toLowerCase();

      if (type !== "ALL" && card.type !== type) return false;
      if (rarity !== "ALL" && card.rarity !== rarity) return false;
      if (q && !hay.includes(q)) return false;
      return true;
    }

    function applyFilters(){
      const type = document.getElementById("filterType").value;
      const rarity = document.getElementById("filterRarity").value;
      const q = (document.getElementById("search").value || "").trim().toLowerCase();
      const filtered = CARDS_JSON.filter(c => cardMatchesFilters(c, {type, rarity, q}));
      render(filtered);
    }

    document.getElementById("filterType").addEventListener("change", applyFilters);
    document.getElementById("filterRarity").addEventListener("change", applyFilters);
    document.getElementById("search").addEventListener("input", applyFilters);

    document.getElementById("btnCopyJson").addEventListener("click", async () => {
      try{
        await navigator.clipboard.writeText(JSON.stringify(CARDS_JSON, null, 2));
        alert("JSON copi√© dans le presse-papiers !");
      }catch(e){
        alert("Copie impossible ‚Äî copie manuelle du JSON requise.");
      }
    });

    /* Initial render */
    render(CARDS_JSON);
  </script>
</body>
</html>
